!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;(e=(e=(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).L||(e.L={})).Control||(e.Control={})).LineStringSelect=t()}}(function(){return function o(s,a,l){function h(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=a[e]={exports:{}};s[e][0].call(r.exports,function(t){return h(s[e][1][t]||t)},r,r.exports,o,s,a,l)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(i,n,t){(function(t){
/**
 * Leaflet LineString selection control
 * @license MIT
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
var e="undefined"!=typeof window?window.L:void 0!==t?t.L:null;e.Control.LineStringSelect=n.exports=i("./src/select"),e.control.lineStringSelect=function(t){return new e.Control.LineStringSelect(t)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/select":5}],2:[function(t,e,i){var n=t("./marker"),r=n.extend({options:{radiusRatio:1.4},onAdd:function(t){this.on("mouseover",this._onMouseOver,this).on("mouseout",this._onMouseOut,this),n.prototype.onAdd.call(this,t)},onRemove:function(t){this.off("mouseover",this._onMouseOver,this).off("mouseout",this._onMouseOut,this),n.prototype.onRemove.call(this,t)},_onMouseOver:function(){this.setRadius(this.options.radius/this.options.radiusRatio)},_onMouseOut:function(){this.setRadius(this.options.radius*this.options.radiusRatio)}});e.exports=r},{"./marker":4}],3:[function(t,e,i){function a(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function o(t,e,i){return t+i*(e-t)}e.exports={pointSegmentDistance:function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1],o=n*n+r*r,s=o&&((t[0]-e[0])*n+(t[1]-e[1])*(i[1]-e[1]))/o;return a(t,s<=0?e:1<=s?i:[e[0]+s*n,e[1]+s*r])},closestPointOnSegment:function(t,e,i){var n=function(t,e,i){var n=i[0]-e[0],r=i[1]-e[1],o=((t[0]-e[0])*n+(t[1]-e[1])*r)/(n*n+r*r);return o<0?0:1<o?1:o}(t,e,i),r=i[0]-e[0],o=i[1]-e[1];return[e[0]+n*r,e[1]+n*o]},pointOnSegment:function(t,e,i,n){var r=i/n;return[o(t[0],e[0],r),o(t[1],e[1],r)]},distance:function(t,e){return Math.sqrt(a(t,e))}}},{}],4:[function(t,i,e){(function(t){var e="undefined"!=typeof window?window.L:void 0!==t?t.L:null;i.exports=e.CircleMarker.extend({show:function(){return this._container.style.visibility="",this},hide:function(){return this._container.style.visibility="hidden",this}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(l,h,t){(function(i){var a="undefined"!=typeof window?window.L:void 0!==i?i.L:null,m=l("./geometry"),n=l("./marker"),r=l("./endpoint"),o=l("./selection"),s=i.Rbush||l("rbush"),e=a.Browser.touch?"touchstart mousedown":"mousedown",t=a.Control.extend({statics:{Selection:o,Endpoint:r,ControlMarker:n},options:{startMarkerClass:"select-marker select-start-marker",endMarkerClass:"select-marker select-end-marker",movingMarkerClass:"select-marker select-moving-marker",name:"leaflet-linestring-select",lineWeight:6,lineTolerance:a.Browser.mobile?10:5,movingMarkerStyle:{fillColor:"#fff",fillOpacity:1,weight:4,opacity:.5,color:"#000"},endpointStyle:{radius:7,color:"#111",fillColor:"#fff",fillOpacity:1},selectionStyle:{color:"#0ff",opacity:1},useTouch:a.Browser.mobile,position:"topright"},initialize:function(t){t=t||{},this._startMarker=null,this._endMarker=null,this._movingMarker=null,this._feature=null,this._layer=null,this._selection=null,this._tolerance=null,a.Util.setOptions(this,t),a.Control.prototype.initialize.call(this,this.options)},onAdd:function(t){var e=this._container=a.DomUtil.create("div",this.options.containerClass);return a.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),e},onRemove:function(t){this.disable()},enable:function(t){return this._layer=t.layer,this._feature=t.feature||t.layer.toGeoJSON(),this._createHandles(),this._buildTree(),this._layer.on("click",this._onLayerClick,this),this._map.on("moveend zoomend resize",this._calculatePointerTolerance,this).on("mousemove touchmove",this._onMousemove,this).on(e,this._onMouseDown,this).on("click contextmenu",this._onMapClick,this),this._calculatePointerTolerance(),this},disable:function(){return this.reset(),this._map.removeLayer(this._movingMarker),this._movingMarker=null,this._layer.off("click",this._onLayerClick,this),this._map.off("moveend zoomend resize",this._calculatePointerTolerance,this).off("mousemove touchmove",this._onMousemove,this).off(e,this._onMouseDown,this).off("click contextmenu",this._onMapClick,this),this._feature=null,this._layer=null,this},reset:function(){return this._startMarker&&(this._map.removeLayer(this._startMarker),this._startMarker=null),this._endMarker&&(this._map.removeLayer(this._endMarker),this._endMarker=null),this._selection&&(this._map.removeLayer(this._selection),this._selection=null),this._movingMarker.setLatLng(this._layer.getLatLngs()[0]),this.options.useTouch||this._map.addLayer(this._movingMarker),this.fire("reset"),this},getSelection:function(){return this._selection?this._selection.getLatLngs():null},toGeoJSON:function(){return this._selection?this._selection.toGeoJSON():null},selectMeters:function(t,e){if(this.reset(),t<0||e<0)throw new Error("Can't use negative meter values for distance selection");var i=this._pointAtM(t),n=this._pointAtM(e);return i=this._getNearestPoint(i),n=this._getNearestPoint(n),this._setPoint(i,i.start,i.end),this._setPoint(n,n.start,n.end),this},movingMarkerFactory:function(t,e){return new n(t,e)},endpointFactory:function(t,e,i){return new r(t,e)},selectionFactory:function(t,e,i){return new o(t,e,i)},_distance:function(t,e){return this.options.distance?this.options.distance(t,e):new a.LatLng(t[1],t[0]).distanceTo(new a.LatLng(e[1],e[0]))},_getProjectedPoint:function(t){return this.options.getProjectedPoint?this.options.getProjectedPoint.call(this,t):[(t=this._map.options.crs.latLngToPoint(new a.LatLng(t[1],t[0]),this._map.getMaxZoom())).x,t.y]},_pointAtSegmentM:function(t,e,i){var n=this._distance(t,e);t=this._getProjectedPoint(t),e=this._getProjectedPoint(e);var r=m.pointOnSegment(t,e,i,n);return a.point(r)},_pointAtM:function(t){var e,i,n,r=this._feature.geometry.coordinates,o=0;for(i=1,n=r.length;i<n;i++){var s=this._distance(r[i-1],r[i]);if(!(o+s<=t))break;o+=s}return o===t||i===r.length?(e=r[i-1],new a.LatLng(e[1],e[0])):(e=this._pointAtSegmentM(r[i-1],r[i],t-o),this._map.options.crs.pointToLatLng(e,this._map.getMaxZoom()))},_calculatePointerTolerance:function(){var t=this._map.getCenter(),e=.5*this.options.lineWeight+this.options.lineTolerance,i=this._map.layerPointToLatLng(this._map.latLngToLayerPoint(t).add(new a.Point(e,e)));this._tolerance=new a.LatLng(Math.abs(t.lat-i.lat),Math.abs(t.lng-i.lng))},_createHandles:function(){var t=a.latLng(this._layer.getLatLngs()[0]),e=this.options.movingMarkerStyle;e.radius=this.options.lineTolerance,e.className=this.options.movingMarkerClass,this._movingMarker=this.movingMarkerFactory(t,e).addTo(this._map),this._movingMarker.on("click",this._onMovingMarkerClick,this),this.options.useTouch&&this._map.removeLayer(this._movingMarker)},_onMovingMarkerClick:function(t){a.DomEvent.stopPropagation(t),this._setPoint(this._movingMarker.getLatLng(),this._movingMarker.start,this._movingMarker.end)},_onLayerClick:function(t){var e=this._getNearestPoint(t.latlng);e?this._setPoint(a.latLng(e),e.start,e.end):this._setPoint(t.latlng)},_onMapClick:function(t){if(!this._endMarker){var e=this._map.latLngToLayerPoint(t.latlng),i=this._movingMarker.getLatLng();if(this.options.useTouch){var n=this._getNearestPoint(t.latlng);n&&(i=a.latLng(n),this._movingMarker.setLatLng(i))}var r=this._map.latLngToLayerPoint(i);m.distance([e.x,e.y],[r.x,r.y])<=2*this.options.lineTolerance&&(i=this._getNearestPoint(i),this._setPoint(i,i.start,i.end))}},_setPoint:function(t,e,i){var n=this.options.endpointStyle;this._startMarker?this._endMarker||(n.className=this.options.endMarkerClass,this._endMarker=this.endpointFactory(t,n,!0).addTo(this._map),this._endMarker.start=e,this._endMarker.end=i,this._map.removeLayer(this._movingMarker),this.fire("select:end",{latlng:t}),this._startMarker&&this._endMarker&&this._onSelect()):(n.className=this.options.startMarkerClass,this._startMarker=this.endpointFactory(t,n,!1).addTo(this._map),this._startMarker.start=e,this._startMarker.end=i,this.fire("select:start",{latlng:t}))},_getPointerBounds:function(t){var e=this._tolerance.lng,i=this._tolerance.lat;return{minY:t.lat-i,minX:t.lng-e,maxY:t.lat+i,maxX:t.lng+e}},_onMouseDown:function(t){var e,i=t.originalEvent.target||t.originalEvent.srcElement;this.options.useTouch&&(this._startMarker&&(e=this._map.latLngToContainerPoint(this._startMarker.getLatLng()),m.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._startMarker._path)),this._endMarker&&(e=this._map.latLngToContainerPoint(this._endMarker.getLatLng()),m.distance([t.containerPoint.x,t.containerPoint.y],[e.x,e.y])<=2*this.options.lineTolerance&&(i=this._endMarker._path)));this._startMarker&&this._startMarker._path===i?(this._dragging=this._startMarker,this._static=this._endMarker):this._endMarker&&this._endMarker._path===i&&(this._dragging=this._endMarker,this._static=this._startMarker),this._dragging&&(a.DomEvent.stop(t),this._dragging._dragging=!0,a.Draggable._disabled=!0,this._map.dragging.disable(),this._map.once("mouseup",this._stopHandlerDrag,this))},_stopHandlerDrag:function(t){this._dragging&&(i.clearTimeout(this._dragTimer),a.Draggable._disabled=!1,this._map.dragging.enable(),this._dragging._dragging=null,this._dragging=null,this._onDragStopped(this._dragging,t.latlng))},_onDragStopped:function(t,e){this._startMarker&&this._endMarker&&this._onSelect()},_checkEndPoints:function(){if(this._startMarker.start>this._endMarker.start){var t=this._startMarker;this._startMarker=this._endMarker,this._endMarker=t}},_onSelect:function(){this._checkEndPoints();var t=this._startMarker.end,e=this._endMarker.start,i=this._layer._latlngs.slice(t,e+1);i.unshift(this._startMarker.getLatLng()),i.push(this._endMarker.getLatLng()),this._selection?(this._selection._latlngs=i,this._selection.updatePathFromSource(this._startMarker.end,this._endMarker.start)):(this._selection=this.selectionFactory(i,this.options.selectionStyle,this._layer).addTo(this._map),this._startMarker.bringToFront(),this._endMarker.bringToFront()),this.fire("selection")},_onMousemove:function(t){var e=this._getNearestPoint(t.latlng);this._dragging?(e&&(this._dragging.start=e.start,this._dragging.end=e.end,this._dragging.setLatLng(e)),this._startMarker&&this._endMarker&&this._onSelect(),i.clearTimeout(this._dragTimer),this._dragTimer=i.setTimeout(this._stopHandlerDrag.bind(this,t),750)):e&&(this._movingMarker.setLatLng(e),this._movingMarker.start=e.start,this._movingMarker.end=e.end)},_getNearestPoint:function(t,e){var i=this._getPointerBounds(t,e),n=this._tree.search(i);if(0===n.length)return null;var r=this._feature.geometry.coordinates,o=Number.MAX_VALUE,s=[t.lng,t.lat],a=n[0].start,l=n[0].end,h=r[a],c=r[l];if(1<n.length)for(var _=0,d=n.length;_<d;_++){var u=n[_],g=r[u.start],f=r[u.end],p=m.pointSegmentDistance(s,g,f);p<o&&(o=p,h=g,c=f,a=u.start,l=u.end)}return(s=[(s=m.closestPointOnSegment(s,h,c))[1],s[0]]).start=a,s.end=l,s},_buildTree:function(){var t=this._feature.geometry.coordinates,e=[];this._tree?this._tree.clear():this._tree=new s(16);for(var i=1,n=t.length;i<n;i++){var r=this._toTreeNode(t[i-1],t[i]);r.start=i-1,r.end=i,e.push(r)}this._tree.load(e)},_toTreeNode:function(t,e){var i=t[0],n=e[0],r=t[1],o=e[1];return n<i&&(n=t[0],i=e[0]),o<r&&(o=t[1],r=e[1]),{minX:i,minY:r,maxX:n,maxY:o}}});a.Util.extend(t.prototype,a.Evented.prototype),h.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./endpoint":2,"./geometry":3,"./marker":4,"./selection":6,rbush:void 0}],6:[function(t,i,e){(function(t){var n="undefined"!=typeof window?window.L:void 0!==t?t.L:null,e=n.Polyline.extend({initialize:function(t,e,i){this._source=i,n.Polyline.prototype.initialize.call(this,t,e)},updatePathFromSource:function(t,e){var i=this._source._rings[0].slice(t,e+1);i.unshift(this._map.latLngToLayerPoint(this._latlngs[0])),i.push(this._map.latLngToLayerPoint(this._latlngs[this._latlngs.length-1])),this._rings[0]=i,this._update()}});i.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
